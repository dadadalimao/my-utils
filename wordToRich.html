<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <title>Wordè½¬å¯Œæ–‡æœ¬è½¬æ¢å™¨</title>
  <link href="/css/quill.snow.css" rel="stylesheet">
  <!-- å¼•å…¥ç»Ÿä¸€å¯¼èˆªæ  -->
  <script src="nav.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 20px auto;
      padding: 20px;
    }

    .container {
      border: 2px dashed #ccc;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
    }

    .upload-section {
      text-align: center;
      margin: 20px 0;
    }

    #fileInput {
      display: none;
    }

    .upload-label {
      background-color: #4CAF50;
      color: white;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
    }

    #editor {
      height: 400px;
      margin-top: 20px;
    }

    .instructions {
      color: #666;
      margin: 15px 0;
      font-size: 0.9em;
    }

    /* æ·»åŠ è½¬æ¢åçš„æ ·å¼ */
    .ql-editor p {
      margin: 0 0 1em 0;
      line-height: 1.5;
    }

    .ql-editor h1,
    .ql-editor h2,
    .ql-editor h3,
    .ql-editor h4,
    .ql-editor h5,
    .ql-editor h6 {
      margin: 1em 0 0.5em 0;
      line-height: 1.5;
    }

    .ql-editor blockquote {
      margin: 1em 0;
      padding: 0.5em 1em;
      border-left: 4px solid #ccc;
    }

    .ql-editor pre {
      margin: 1em 0;
      padding: 1em;
      background-color: #f5f5f5;
      border-radius: 4px;
    }

    .ql-editor table {
      border-collapse: collapse;
      width: 100%;
      margin: 1em 0;
    }

    .ql-editor th,
    .ql-editor td {
      padding: 8px;
      border: 1px solid #ddd;
    }

    .ql-editor th {
      background-color: #f5f5f5;
    }

    .ql-editor p.center {
      text-align: center;
    }

    /* æ·»åŠ æ–‡æœ¬æ ¼å¼æ ·å¼ */
    .ql-editor .ql-bold {
      font-weight: bold;
    }

    .ql-editor .ql-italic {
      font-style: italic;
    }

    .ql-editor .ql-underline {
      text-decoration: underline;
    }

    .ql-editor .ql-strike {
      text-decoration: line-through;
    }

    /* ç¼©è¿›æ ·å¼ */
    .ql-editor p[style-name^="ç¼©è¿›"] {
      text-indent: var(--indent-value);
    }
  </style>
</head>

<body>
  <div class="container">
    <h2>Wordæ–‡æ¡£è½¬å¯Œæ–‡æœ¬è½¬æ¢å™¨</h2>

    <div class="upload-section">
      <div class="instructions">
        æ”¯æŒæ ¼å¼ï¼š.docxï¼ˆWord 2007+ï¼‰<br>
        æœ€å¤§æ–‡ä»¶å¤§å°ï¼š5MB
      </div>

      <input type="file" id="fileInput" accept=".docx">
      <label for="fileInput" class="upload-label">é€‰æ‹©Wordæ–‡ä»¶</label>

      <div class="instructions">æˆ–æ‹–æ”¾æ–‡ä»¶åˆ°æ­¤åŒºåŸŸ</div>
    </div>

    <div id="editor"></div>
  </div>

  <!-- å¼•å…¥æ‰€éœ€åº“ -->
  <script src="/js/quill.js"></script>
  <script src="/js/mammoth.browser.min.js"></script>
  <script src="/js/mammoth.config.js"></script>
  <script>
    // åˆå§‹åŒ–Quillå¯Œæ–‡æœ¬ç¼–è¾‘å™¨
    const quill = new Quill('#editor', {
      theme: 'snow',
      modules: {
        toolbar: [
          ['bold', 'italic', 'underline'],
          [{ 'header': 1 }, { 'header': 2 }],
          ['blockquote', 'code-block'],
          [{ 'list': 'ordered' }, { 'list': 'bullet' }],
          [{ 'align': [] }],
          ['link', 'image'],
          ['clean']
        ]
      }
    });

    // æ–‡ä»¶é€‰æ‹©å¤„ç†
    document.getElementById('fileInput').addEventListener('change', handleFile);

    // æ‹–æ”¾å¤„ç†
    const container = document.querySelector('.container');
    container.addEventListener('dragover', (e) => {
      e.preventDefault();
      container.style.backgroundColor = '#f0f0f0';
    });

    container.addEventListener('dragleave', () => {
      container.style.backgroundColor = '';
    });

    container.addEventListener('drop', (e) => {
      e.preventDefault();
      container.style.backgroundColor = '';
      handleFile(e.dataTransfer);
    });

    // æ–‡ä»¶å¤„ç†å‡½æ•°
    function handleFile(input) {

      let file;
      if (input.target && input.target instanceof HTMLInputElement) {
        file = input.target.files[0];
        // console.log("ğŸš€ ~ handleFile ~ input:", input, input.target.files)
      } else if (input instanceof DataTransfer) {
        // console.log("ğŸš€ ~ handleFile ~ input:", input, input.files)
        file = input.files[0];
      }

      if (!file) return;
      if (!file.name.endsWith('.docx')) {
        alert('è¯·é€‰æ‹©.docxæ ¼å¼çš„Wordæ–‡æ¡£');
        return;
      }

      const reader = new FileReader();

      reader.onload = function (e) {
        const arrayBuffer = e.target.result;

        // ä½¿ç”¨Mammothè½¬æ¢æ–‡æ¡£ï¼Œå¸¦styleMap
        mammoth.convertToHtml({ arrayBuffer: arrayBuffer }, options)
          .then((result) => {
            console.log("ğŸš€ ~ .then ~ result:", result);
            quill.clipboard.dangerouslyPasteHTML(result.value);
          })
          .catch((err) => {
            console.error('è½¬æ¢é”™è¯¯:', err);
            alert('æ–‡æ¡£è½¬æ¢å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼');
          });
      };

      reader.readAsArrayBuffer(file);
    }
  </script>
</body>

</html>