<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wordè½¬HTML</title>

    <!-- å¼•å…¥ mammoth.js åº“ -->
    <script src="js/mammoth.browser.min.js"></script>
    <!-- å¼•å…¥ FileSaver.js åº“ -->
    <script src="js/FileSaver.js"></script>
    <!-- å¼•å…¥ç»Ÿä¸€å¯¼èˆªæ  -->
    <script src="nav.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        #output {
            margin-top: 20px;
        }
    </style>
</head>

<body>
    <h1>Wordè½¬HTML</h1>
    <div id="dropZone" style="border: 2px dashed #ccc; padding: 20px; text-align: center; margin: 20px 0;">
        æ‹–æ”¾æ–‡ä»¶åˆ°è¿™é‡Œ æˆ–
        <input type="file" id="fileInput" accept=".docx">
    </div>
    <button id="convertButton">è½¬æ¢å¹¶ä¸‹è½½</button>
    <div id="output"></div>

    <script>
        // æ·»åŠ æ‹–æ”¾äº‹ä»¶å¤„ç†
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');

        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.style.backgroundColor = '#f0f0f0';
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.style.backgroundColor = '';
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.style.backgroundColor = '';
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                fileInput.files = files;
            }
        });

        document.getElementById('convertButton').addEventListener('click', function () {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (event) {
                    const arrayBuffer = event.target.result;
                    const styleMap = [
                        "p => p:margin-top(0):margin-bottom(0):line-height(1.5)", // ä¿ç•™æ®µè½çš„è¡Œé«˜
                        "h1 => h1:margin-top(0):margin-bottom(0):line-height(1.5)", // ä¿ç•™æ ‡é¢˜çš„è¡Œé«˜
                        "h2 => h2:margin-top(0):margin-bottom(0):line-height(1.5)",
                        "h3 => h3:margin-top(0):margin-bottom(0):line-height(1.5)",
                        "h4 => h4:margin-top(0):margin-bottom(0):line-height(1.5)",
                        "h5 => h5:margin-top(0):margin-bottom(0):line-height(1.5)",
                        "h6 => h6:margin-top(0):margin-bottom(0):line-height(1.5)",
                        "table => table:border-collapse(collapse):width(100%)",
                        "td => td:padding(5px):border(1px solid #ddd)",
                        "th => th:padding(5px):border(1px solid #ddd):background-color(#f5f5f5)",
                        "ul => ul:list-style-type(disc):margin-left(20px)",
                        "ol => ol:list-style-type(decimal):margin-left(20px)",
                        "li => li:margin-bottom(5px)",
                        "strong => strong:font-weight(bold)",
                        "em => em:font-style(italic)",
                        "u => u:text-decoration(underline)"
                    ];
                    mammoth.convertToHtml({ arrayBuffer: arrayBuffer, styleMap: styleMap })
                        .then(function (result) {
                            const htmlContent = result.value; // The generated HTML
                            console.log("ğŸš€ ~ htmlContent:", htmlContent)
                            // è·å–æ–‡ä»¶åï¼ˆå»æ‰æ‰©å±•åï¼‰
                            const fileName = file.name.replace(/\.docx?$/i, '');
                            const fullHtmlContent = `
<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${fileName}</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        ol {
            padding-inline-start: 12px;
        }
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            line-height: 1.6;
            color: #333;
        }
        p, h1, h2, h3, h4, h5, h6 {
            line-height: 1.5;
            margin: 10px 0;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 15px 0;
        }
        th, td {
            padding: 8px;
            border: 1px solid #ddd;
        }
        th {
            background-color: #f5f5f5;
        }
        ul, ol {
            margin: 10px 0 10px 20px;
        }
        li {
            margin-bottom: 5px;
        }
        img {
            max-width: 100%;
            height: auto;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    ${htmlContent}
    console.log("ğŸš€ ~ htmlContent:", htmlContent)
</body>
</html>
`;
                            const blob = new Blob([fullHtmlContent], { type: 'text/html;charset=utf-8' });
                            saveAs(blob, fileName + '.html');
                        })
                        .catch(function (err) {
                            console.error(err);
                            alert('è½¬æ¢å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼æˆ–é‡è¯•ã€‚');
                        });
                };
                reader.readAsArrayBuffer(file);
            } else {
                alert('è¯·é€‰æ‹©ä¸€ä¸ªWordæ–‡ä»¶ã€‚');
            }
        });
    </script>
</body>

</html>